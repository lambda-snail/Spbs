@page "/expenses"

<MudGrid>
    <MudItem xs="12">
        <MudElement HtmlTag="h1">
            Expenses Overview
        </MudElement>
    </MudItem>
    <MudItem xs="12">
        <MudPaper Elevation="25" Class="my-1">
            <MudToolBar>
                <MudIconButton Icon="@Icons.Material.Outlined.Add" OnClick="() => ToggleExpenseDialog(null)"/>
                <MudIconButton Icon="@Icons.Material.Outlined.Edit" Disabled="@(_numSelectedExpenses != 1)" OnClick="EditSelectedItem"/>
                <MudIconButton Icon="@Icons.Material.Outlined.Remove" Color="Color.Inherit" Disabled="@(_numSelectedExpenses == 0)" OnClick="DeleteExpenses"/>
                <MudSpacer/>

                <MudDatePicker
                    Label="Filter Expenses for Month"
                    @bind-Date="_dateFilterYearMonth"
                    OpenTo="OpenTo.Year"
                    FixDay="1"
                    DateFormat="yyyy-MM"
                    PickerMonthChanged="ReloadData"/>

                <MudSpacer/>
                <MudIconButton Icon="@Icons.Material.Outlined.Settings" Color="Color.Inherit"/>
            </MudToolBar>
        </MudPaper>
    </MudItem>
    <MudItem xs="12">
        <MudDataGrid T="Expense"
                     @ref="@_grid"
                     Items="@_cachedExpenses"
                     EditMode="DataGridEditMode.Form"
                     EditTrigger="DataGridEditTrigger.OnRowClick"
                     Filterable="true"
                     SortMode="@SortMode.Multiple"
                     MultiSelection="true"
                     SelectedItemsChanged="@SelectedItemsChanged"
                     Groupable="false">
            <Columns>
                <SelectColumn T="Expense"/>
                <TemplateColumn T="Expense" Title="Name">
                    <CellTemplate>
                        <MudButton Variant="Variant.Text" Color="Color.Primary">
                            <NavLink href="@GetExpenseDetailsUrl(context.Item)">@context.Item.Name</NavLink>
                        </MudButton>
                    </CellTemplate>
                </TemplateColumn>

                <PropertyColumn Property="x => x.Date"/>
                <PropertyColumn Property="x => x.Total"/>
                <PropertyColumn Property="x => x.Category"/>
                <PropertyColumn Property="x => x.Venue"/>

            </Columns>
            <PagerContent>
                <MudDataGridPager T="Expense"/>
            </PagerContent>
        </MudDataGrid>
    </MudItem>
</MudGrid>

<EditExpenseComponent @ref="_editExpenseComponent" GetUserId="() => _userId" OnUpdateCallback="ExpenseItemAdded"></EditExpenseComponent>
