@page "/accounts/links/{RequisitionId}"
@using Integrations.Nordigen.Models
@inherits SelectableListComponent<Guid>

@if (_link is not null)
{
    <MudText Typo="Typo.h4" GutterBottom="true" Class="mt-4">Accounts Connected to @_link.InstitutionId</MudText>

    <MudDivider Class="mb-4"/>

    <MudText Typo="Typo.h5" GutterBottom="true">All Connected Accounts</MudText>

    <MudPaper Class="pa-2 mb-4">
        <MudGrid>
            <MudItem xs="6">
                <MudTextField Value="@_link.InstitutionId" Label="Institution" ReadOnly="true" Variant="Variant.Text"/>
            </MudItem>
            <MudItem xs="6">
                <MudTextField Value="@_link.Created.ToString()" Label="Created On" ReadOnly="true" Variant="Variant.Text"/>
            </MudItem>
            <MudItem xs="6">
                <Mud TextField Value="@_link.Created.ToString()" Label="Created On" ReadOnly="true" Variant="Variant.Text"/>
                <MudNumericField Value="@_link.Accounts.Count" Label="LinkedList Accounts" Variant="Variant.Text" ReadOnly="true"/>
            </MudItem>
        </MudGrid>
    </MudPaper>

    <MudToolBar>
        <MudTooltip Text="@GetLoadButtonTooltip()">
        <MudButton Disabled="@(_selectedAccounts is not { Count: 1 })"
                   OnClick="LoadTransactionsFromNordigen"
                   Color="Color.Primary">
            Load Expenses
        </MudButton>
        </MudTooltip>
        <MudTooltip Text="@GetImportButtonTooltip()">
        <MudButton Disabled="@(_loadedTransactions is not { Count: >0 })"
                   OnClick="ProceedToImportPage"
                   Variant="Variant.Outlined"
                   Color="Color.Secondary">
            Proceed to Import
        </MudButton>
        </MudTooltip>

        @if (_loadedTransactions is { Count: >0 })
        {
            <MudText>Loaded @_loadedTransactions.Count transactions</MudText>
        }

        <MudSpacer/>

        <MudDateRangePicker Label="Custom start month" StartMonth="@DateTime.Now.AddMonths(-1)" @bind-DateRange="@_transactionsRequestParameters.Range"/>

    </MudToolBar>

    <MudDataGrid T="AccountV2"
                 @ref="_grid"
                 Items="@_accounts"
                 MultiSelection="true"
                 Filterable="false"
                 Hideable="false"
                 SelectedItemsChanged="@OnSelectionChanged"
                 Dense="true">
        <Columns>
            <SelectColumn T="AccountV2"/>
            <PropertyColumn Property="x => x.Iban"/>
            <PropertyColumn Property="x => x.Status"/>
            <PropertyColumn Property="x => x.Created" Title="Created On"/>
            <PropertyColumn Property="x => x.LastAccessed" Title="Last Accessed"/>
        </Columns>
        <PagerContent>
            <MudDataGridPager T="AccountV2"/>
        </PagerContent>
    </MudDataGrid>
}
